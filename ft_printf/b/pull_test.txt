#!/bin/bash
sleep_interval=5s
have_new_code () 
{
	echo exec: git pull
	pull_result=$(git pull)
	echo $pull_result
	if [ "$pull_result" == "Already up to date." ]
	then
		return 0
	else
		return 1
	fi
}

build()
{
	cmake ..
	echo cmake .. result = $?
	if (($? != 0))
	then
		exit $?
	fi
	cmake --build .
	echo cmake --build . result = $?
	if (($? != 0))
	then
		exit $?
	fi
}

run()
{
	./ft_printf_tests/ft_printf_tests 2>err.txt
}

handle_new_code()
{
	have_new_code
	if [ $? == 1 ]
	then
		echo "new code pulled"
	else
		echo "no new"
		#return 0
	fi
	build
	run
	#email

}

loop_body()
{
	handle_new_code
	sleep $sleep_interval
}



echo "Press [CTRL+C] to stop.."
while true
do
	loop_body
done